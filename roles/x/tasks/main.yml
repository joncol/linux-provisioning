---
- block:
    - package:
        name: lightdm,lightdm-gtk-greeter,xsel,xclip
      become: yes

    - package: name=libx11-dev
      when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'
      become: yes

    - systemd:
        name: lightdm
        enabled: yes
      become: yes

    - copy:
        src: x-init-kb.sh
        dest: /usr/local/bin/
        mode: preserve
      become: yes

    - lineinfile:
        path: /etc/lightdm/lightdm.conf
        regexp: '^#display-setup-script='
        line: 'display-setup-script=/usr/local/bin/x-init-kb.sh'
      become: yes

    - name: build dmenu2 from source
      block:
        - file:
            path: ~/repos/dmenu2
            state: directory

        - hg:
            repo: https://bitbucket.org/melek/dmenu2
            dest: ~/repos/dmenu2

        - make:
            chdir: ~/repos/dmenu2
            target: "{{ item }}"
          loop:
            - clean
            - install

      become: yes
      when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

    - aur: name=dmenu2
      when: ansible_distribution == 'Archlinux'

  tags: x
